<div class="loading-container" *ngIf="loading">
  <nz-spin nzSize="large" nzTip="Loading project..."></nz-spin>
</div>

<div class="page-container" *ngIf="!loading && project">
  <div class="page-header">
    <button nz-button nzType="link" (click)="goBack()" class="back-button">
      <span nz-icon nzType="arrow-left"></span>
      Back to Projects
    </button>
  </div>

  <div class="project-header">
    <div class="header-content">
      <div class="title-section">
        <span nz-icon nzType="project" class="title-icon"></span>
        <div class="title-info">
          <div class="title-row">
            <h1>{{ project.name }}</h1>
            <nz-tag [nzColor]="getStatusColor(project.status)" class="status-tag">
              <span nz-icon nzType="check-circle" nzTheme="fill" *ngIf="project.status === 'Active'"></span>
              <span nz-icon nzType="clock-circle" nzTheme="fill" *ngIf="project.status === 'On Hold'"></span>
              <span nz-icon nzType="close-circle" nzTheme="fill" *ngIf="project.status === 'Inactive'"></span>
              <span nz-icon nzType="check-circle" nzTheme="fill" *ngIf="project.status === 'Completed'"></span>
              {{ project.status }}
            </nz-tag>
          </div>
          <div class="project-meta">
            <span class="meta-item">
              <span nz-icon nzType="code" class="meta-icon"></span>
              {{ project.code }}
            </span>
            <span class="meta-item" *ngIf="project.startDate">
              <span nz-icon nzType="calendar" class="meta-icon"></span>
              {{ project.startDate | date: 'dd MMM yyyy' }}
            </span>
            <span class="meta-item">
              <span nz-icon nzType="appstore" class="meta-icon"></span>
              {{ project.workstreamCount }} Workstreams
            </span>
            <span class="meta-item">
              <span nz-icon nzType="flag" class="meta-icon"></span>
              {{ project.milestoneCount }} Milestones
            </span>
          </div>
        </div>
      </div>
      <div class="header-actions">
        <button nz-button nzType="default" class="action-btn">
          <span nz-icon nzType="edit"></span>
          Edit
        </button>
        <button nz-button nzType="default" class="action-btn">
          <span nz-icon nzType="share-alt"></span>
          Share
        </button>
        <button nz-button nzType="primary" class="action-btn-primary">
          <span nz-icon nzType="plus"></span>
          Add Workstream
        </button>
      </div>
    </div>
  </div>

  <nz-tabs nzType="line" class="project-tabs" nzSize="large">
    <nz-tab [nzTitle]="overviewTitle">
      <ng-template #overviewTitle>
        <span nz-icon nzType="dashboard" class="tab-icon"></span>
        Overview
      </ng-template>
      <div class="tab-content">
        <div class="overview-grid">
          <nz-card nzTitle="Project Information" class="info-card" [nzExtra]="infoExtra">
            <ng-template #infoExtra>
              <span nz-icon nzType="info-circle" class="card-icon"></span>
            </ng-template>
            <nz-descriptions nzBordered [nzColumn]="2">
              <nz-descriptions-item nzTitle="Project Code">
                <span class="code-badge">{{ project.code }}</span>
              </nz-descriptions-item>
              <nz-descriptions-item nzTitle="Status">
                <nz-tag [nzColor]="getStatusColor(project.status)">{{ project.status }}</nz-tag>
              </nz-descriptions-item>
              <nz-descriptions-item nzTitle="Start Date" [nzSpan]="1">
                <span nz-icon nzType="calendar" class="desc-icon"></span>
                {{ project.startDate ? (project.startDate | date: 'dd MMMM yyyy') : 'Not set' }}
              </nz-descriptions-item>
              <nz-descriptions-item nzTitle="End Date" [nzSpan]="1">
                <span nz-icon nzType="calendar" class="desc-icon"></span>
                {{ project.endDate ? (project.endDate | date: 'dd MMMM yyyy') : 'Not set' }}
              </nz-descriptions-item>
              <nz-descriptions-item nzTitle="Description" [nzSpan]="2">
                <span class="description-text">{{ project.description || 'No description provided' }}</span>
              </nz-descriptions-item>
            </nz-descriptions>
          </nz-card>

          <nz-card nzTitle="Quick Stats" class="info-card stats-summary" [nzExtra]="statsExtra">
            <ng-template #statsExtra>
              <span nz-icon nzType="bar-chart" class="card-icon"></span>
            </ng-template>
            <div class="quick-stats">
              <div class="quick-stat-item">
                <div class="quick-stat-icon workstream-color">
                  <span nz-icon nzType="branches"></span>
                </div>
                <div class="quick-stat-info">
                  <div class="quick-stat-value">{{ project.workstreamCount }}</div>
                  <div class="quick-stat-label">Total Workstreams</div>
                </div>
              </div>
              <div class="quick-stat-item">
                <div class="quick-stat-icon milestone-color">
                  <span nz-icon nzType="flag"></span>
                </div>
                <div class="quick-stat-info">
                  <div class="quick-stat-value">{{ project.milestoneCount }}</div>
                  <div class="quick-stat-label">Total Milestones</div>
                </div>
              </div>
              <div class="quick-stat-item">
                <div class="quick-stat-icon team-color">
                  <span nz-icon nzType="team"></span>
                </div>
                <div class="quick-stat-info">
                  <div class="quick-stat-value">0</div>
                  <div class="quick-stat-label">Team Members</div>
                </div>
              </div>
            </div>
          </nz-card>
        </div>

        <nz-card nzTitle="Activity Timeline" class="info-card timeline-card" [nzExtra]="timelineExtra">
          <ng-template #timelineExtra>
            <span nz-icon nzType="history" class="card-icon"></span>
          </ng-template>
          <div class="timeline-content">
            <div class="timeline-item">
              <div class="timeline-marker created"></div>
              <div class="timeline-info">
                <div class="timeline-title">Project Created</div>
                <div class="timeline-date">{{ project.startDate ? (project.startDate | date: 'dd MMM yyyy, HH:mm') : 'Date not available' }}</div>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-marker active"></div>
              <div class="timeline-info">
                <div class="timeline-title">Currently {{ project.status }}</div>
                <div class="timeline-date">Last updated today</div>
              </div>
            </div>
          </div>
        </nz-card>
      </div>
    </nz-tab>

    <nz-tab [nzTitle]="workstreamsTitle">
      <ng-template #workstreamsTitle>
        <span class="tab-title-content">
          <span nz-icon nzType="branches" class="tab-icon"></span>
          <span>Workstreams</span>
          <nz-badge [nzCount]="project.workstreamCount" [nzStyle]="{ backgroundColor: '#722ED1' }"></nz-badge>
        </span>
      </ng-template>
      <div class="tab-content">
        <nz-card class="workstreams-card">
          <div class="workstreams-header">
            <div class="header-left">
              <h3>
                <span nz-icon nzType="branches" class="header-icon"></span>
                Project Workstreams
              </h3>
              <p>Manage and track workstreams for this project</p>
            </div>
            <button nz-button nzType="primary" (click)="openAddWorkstreamModal()">
              <span nz-icon nzType="plus"></span>
              Add Workstream
            </button>
          </div>

          <nz-spin [nzSpinning]="loadingWorkstreams">
            <div *ngIf="!loadingWorkstreams && workstreams.length === 0" class="empty-state">
              <span nz-icon nzType="inbox" class="empty-icon"></span>
              <h4>No Workstreams Yet</h4>
              <p>Get started by adding your first workstream to this project</p>
              <button nz-button nzType="primary" (click)="openAddWorkstreamModal()">
                <span nz-icon nzType="plus"></span>
                Add First Workstream
              </button>
            </div>

            <nz-table 
              *ngIf="!loadingWorkstreams && workstreams.length > 0"
              #workstreamTable 
              [nzData]="workstreams" 
              [nzPageSize]="10"
              [nzShowPagination]="workstreams.length > 10"
              class="workstreams-table">
              <thead>
                <tr>
                  <th nzWidth="40px"></th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Status</th>
                  <th>Start Date</th>
                  <th>End Date</th>
                  <th>Outputs</th>
                  <th nzWidth="150px">Actions</th>
                </tr>
              </thead>
              <tbody>
                <ng-template ngFor let-workstream [ngForOf]="workstreamTable.data">
                  <tr>
                    <td>
                      <button 
                        nz-button 
                        nzType="link" 
                        nzSize="small"
                        (click)="toggleWorkstream(workstream.id)">
                        <span 
                          nz-icon 
                          [nzType]="expandedWorkstreamId === workstream.id ? 'down' : 'right'"
                          nzTheme="outline">
                        </span>
                      </button>
                    </td>
                    <td>
                      <strong class="workstream-name">{{ workstream.name }}</strong>
                    </td>
                    <td>
                      <span class="workstream-desc">{{ workstream.description || 'No description' }}</span>
                    </td>
                    <td>
                      <nz-tag [nzColor]="getStatusColor(workstream.status)">{{ workstream.status }}</nz-tag>
                    </td>
                    <td>
                      <span class="date-text">
                        <span nz-icon nzType="calendar" style="margin-right: 4px;"></span>
                        {{ workstream.startDate ? (workstream.startDate | date: 'dd MMM yyyy') : '-' }}
                      </span>
                    </td>
                    <td>
                      <span class="date-text">
                        <span nz-icon nzType="calendar" style="margin-right: 4px;"></span>
                        {{ workstream.endDate ? (workstream.endDate | date: 'dd MMM yyyy') : '-' }}
                      </span>
                    </td>
                    <td>
                      <nz-badge [nzCount]="workstream.outputCount" [nzStyle]="{ backgroundColor: '#1890FF' }"></nz-badge>
                    </td>
                    <td>
                      <button 
                        nz-button 
                        nzType="link" 
                        nzSize="small" 
                        (click)="openEditWorkstreamModal(workstream)" 
                        nz-tooltip 
                        nzTooltipTitle="Edit">
                        <span nz-icon nzType="edit"></span>
                      </button>
                      <button 
                        nz-button 
                        nzType="link" 
                        nzDanger 
                        nzSize="small"
                        nz-popconfirm
                        nzPopconfirmTitle="Are you sure you want to delete this workstream?"
                        nzPopconfirmPlacement="topRight"
                        (nzOnConfirm)="deleteWorkstream(workstream.id)"
                        nz-tooltip 
                        nzTooltipTitle="Delete">
                        <span nz-icon nzType="delete"></span>
                      </button>
                    </td>
                  </tr>
                  
                  <!-- Expanded Row for Outputs -->
                  <tr *ngIf="expandedWorkstreamId === workstream.id">
                    <td colspan="8" class="output-expanded-row">
                      <div class="output-section">
                        <div class="output-header">
                          <h4>
                            <span nz-icon nzType="appstore" nzTheme="outline"></span>
                            Outputs
                          </h4>
                          <button 
                            nz-button 
                            nzType="primary" 
                            nzSize="small"
                            (click)="openAddOutputModal(workstream.id)">
                            <span nz-icon nzType="plus"></span>
                            Add Output
                          </button>
                        </div>
                        
                        <nz-spin [nzSpinning]="loadingOutputs[workstream.id]">
                          <div *ngIf="!outputs[workstream.id] || outputs[workstream.id].length === 0" class="output-empty">
                            <span nz-icon nzType="inbox" style="font-size: 32px; color: #D9D9D9;"></span>
                            <p>No outputs yet. Click "Add Output" to create one.</p>
                          </div>
                          
                          <nz-table 
                            *ngIf="outputs[workstream.id] && outputs[workstream.id].length > 0"
                            #outputTable
                            [nzData]="outputs[workstream.id]"
                            [nzShowPagination]="false"
                            nzSize="small"
                            class="output-table">
                            <thead>
                              <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>PIC Leader</th>
                                <th>Milestones</th>
                                <th nzWidth="120px">Actions</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let output of outputTable.data">
                                <td><strong>{{ output.name }}</strong></td>
                                <td>{{ output.description || 'No description' }}</td>
                                <td>
                                  <span *ngIf="output.picLeaderName" nz-icon nzType="user" style="margin-right: 4px;"></span>
                                  {{ output.picLeaderName || '-' }}
                                </td>
                                <td>
                                  <nz-badge [nzCount]="output.milestoneCount"></nz-badge>
                                </td>
                                <td>
                                  <button 
                                    nz-button 
                                    nzType="link" 
                                    nzSize="small"
                                    (click)="openEditOutputModal(output)"
                                    nz-tooltip
                                    nzTooltipTitle="Edit">
                                    <span nz-icon nzType="edit"></span>
                                  </button>
                                  <button 
                                    nz-button 
                                    nzType="link" 
                                    nzDanger 
                                    nzSize="small"
                                    nz-popconfirm
                                    nzPopconfirmTitle="Are you sure? This will also delete all milestones."
                                    (nzOnConfirm)="deleteOutput(output)"
                                    nz-tooltip
                                    nzTooltipTitle="Delete">
                                    <span nz-icon nzType="delete"></span>
                                  </button>
                                </td>
                              </tr>
                            </tbody>
                          </nz-table>
                        </nz-spin>
                      </div>
                    </td>
                  </tr>
                </ng-template>
              </tbody>
            </nz-table>
          </nz-spin>
        </nz-card>
      </div>
    </nz-tab>

    <nz-tab [nzTitle]="milestonesTitle">
      <ng-template #milestonesTitle>
        <span class="tab-title-content">
          <span nz-icon nzType="flag" class="tab-icon"></span>
          <span>Milestones</span>
          <nz-badge [nzCount]="project.milestoneCount" [nzStyle]="{ backgroundColor: '#13C2C2' }"></nz-badge>
        </span>
      </ng-template>
      <div class="tab-content">
        <nz-card class="milestones-card">
          <div class="milestones-header">
            <div class="header-left">
              <h3>
                <span nz-icon nzType="flag" class="header-icon"></span>
                Project Milestones
              </h3>
              <p>Track and manage milestones across all workstreams</p>
            </div>
          </div>

          <nz-spin [nzSpinning]="loadingMilestones">
            <div *ngIf="!loadingMilestones && milestones.length === 0" class="empty-state">
              <span nz-icon nzType="inbox" class="empty-icon"></span>
              <h4>No Milestones Yet</h4>
              <p>Milestones will appear here once they are created within workstreams</p>
            </div>

            <nz-table 
              *ngIf="!loadingMilestones && milestones.length > 0"
              #milestoneTable 
              [nzData]="milestones" 
              [nzPageSize]="10"
              [nzShowPagination]="milestones.length > 10"
              class="milestones-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Workstream</th>
                  <th>PIC</th>
                  <th>Status</th>
                  <th>Planned</th>
                  <th>Actual</th>
                  <th>Progress</th>
                  <th nzWidth="100px">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let milestone of milestoneTable.data">
                  <td>
                    <div class="milestone-name-cell">
                      <strong class="milestone-name">{{ milestone.name }}</strong>
                      <span *ngIf="milestone.isCritical" nz-icon nzType="exclamation-circle" nzTheme="fill" class="critical-icon" nz-tooltip nzTooltipTitle="Critical Milestone"></span>
                    </div>
                  </td>
                  <td>
                    <span class="workstream-name">{{ milestone.workstreamName }}</span>
                  </td>
                  <td>
                    <span class="pic-name">{{ milestone.picUserName }}</span>
                  </td>
                  <td>
                    <nz-tag [nzColor]="getMilestoneStatusColor(milestone.status)">
                      {{ getMilestoneStatusLabel(milestone.status) }}
                    </nz-tag>
                  </td>
                  <td>
                    <div class="date-cell">
                      <div class="date-row" *ngIf="milestone.plannedStartDate">
                        <span nz-icon nzType="calendar"></span>
                        <span>{{ milestone.plannedStartDate | date: 'dd MMM yyyy' }}</span>
                      </div>
                      <div class="date-row" *ngIf="milestone.plannedEndDate">
                        <span nz-icon nzType="calendar"></span>
                        <span>{{ milestone.plannedEndDate | date: 'dd MMM yyyy' }}</span>
                      </div>
                      <span *ngIf="!milestone.plannedStartDate && !milestone.plannedEndDate">-</span>
                    </div>
                  </td>
                  <td>
                    <div class="date-cell">
                      <div class="date-row" *ngIf="milestone.actualStartDate">
                        <span nz-icon nzType="calendar"></span>
                        <span>{{ milestone.actualStartDate | date: 'dd MMM yyyy' }}</span>
                      </div>
                      <div class="date-row" *ngIf="milestone.actualEndDate">
                        <span nz-icon nzType="calendar"></span>
                        <span>{{ milestone.actualEndDate | date: 'dd MMM yyyy' }}</span>
                      </div>
                      <span *ngIf="!milestone.actualStartDate && !milestone.actualEndDate">-</span>
                    </div>
                  </td>
                  <td>
                    <div class="progress-cell">
                      <nz-progress 
                        [nzPercent]="milestone.progress" 
                        [nzStatus]="milestone.progress === 100 ? 'success' : 'active'"
                        [nzShowInfo]="true"
                        [nzStrokeWidth]="8">
                      </nz-progress>
                    </div>
                  </td>
                  <td>
                    <button 
                      nz-button 
                      nzType="link" 
                      nzSize="small" 
                      nz-tooltip 
                      nzTooltipTitle="View Details"
                      (click)="openMilestoneDetail(milestone)">
                      <span nz-icon nzType="eye"></span>
                    </button>
                  </td>
                </tr>
              </tbody>
            </nz-table>
          </nz-spin>
        </nz-card>
      </div>
    </nz-tab>

    <nz-tab [nzTitle]="teamTitle">
      <ng-template #teamTitle>
        <span nz-icon nzType="team" class="tab-icon"></span>
        Team
      </ng-template>
      <div class="tab-content">
        <nz-card>
          <p class="empty-state">Team management coming soon...</p>
        </nz-card>
      </div>
    </nz-tab>

    <nz-tab [nzTitle]="documentsTitle">
      <ng-template #documentsTitle>
        <span nz-icon nzType="file-text" class="tab-icon"></span>
        Documents
      </ng-template>
      <div class="tab-content">
        <nz-card>
          <p class="empty-state">Document management coming soon...</p>
        </nz-card>
      </div>
    </nz-tab>
  </nz-tabs>
</div>

<!-- Workstream Modal -->
<nz-modal
  [(nzVisible)]="workstreamModalVisible"
  [nzTitle]="isEditMode ? 'Edit Workstream' : 'Add New Workstream'"
  [nzOkText]="isEditMode ? 'Update' : 'Create'"
  nzCancelText="Cancel"
  (nzOnOk)="handleWorkstreamModalOk()"
  (nzOnCancel)="handleWorkstreamModalCancel()"
  nzWidth="600px">
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="workstreamForm" nzLayout="vertical">
      <nz-form-item>
        <nz-form-label nzRequired>Name</nz-form-label>
        <nz-form-control nzErrorTip="Please enter workstream name">
          <input nz-input formControlName="name" placeholder="Enter workstream name" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Description</nz-form-label>
        <nz-form-control>
          <textarea 
            nz-input 
            formControlName="description" 
            placeholder="Enter workstream description"
            [nzAutosize]="{ minRows: 3, maxRows: 6 }"></textarea>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired>Status</nz-form-label>
        <nz-form-control>
          <nz-select formControlName="status" nzPlaceHolder="Select status">
            <nz-option nzValue="Active" nzLabel="Active"></nz-option>
            <nz-option nzValue="Completed" nzLabel="Completed"></nz-option>
            <nz-option nzValue="On Hold" nzLabel="On Hold"></nz-option>
            <nz-option nzValue="Inactive" nzLabel="Inactive"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <div nz-row [nzGutter]="16">
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label>Start Date</nz-form-label>
            <nz-form-control>
              <nz-date-picker 
                formControlName="startDate" 
                nzPlaceHolder="Select start date"
                style="width: 100%;"></nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label>End Date</nz-form-label>
            <nz-form-control>
              <nz-date-picker 
                formControlName="endDate" 
                nzPlaceHolder="Select end date"
                style="width: 100%;"></nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </form>
  </ng-container>
</nz-modal>

<!-- Output Modal -->
<nz-modal
  [(nzVisible)]="outputModalVisible"
  [nzTitle]="isEditModeOutput ? 'Edit Output' : 'Add New Output'"
  [nzOkText]="isEditModeOutput ? 'Update' : 'Create'"
  nzCancelText="Cancel"
  (nzOnOk)="handleOutputModalOk()"
  (nzOnCancel)="handleOutputModalCancel()"
  nzWidth="600px">
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="outputForm" nzLayout="vertical">
      <nz-form-item>
        <nz-form-label nzRequired>Name</nz-form-label>
        <nz-form-control nzErrorTip="Please enter output name">
          <input nz-input formControlName="name" placeholder="Enter output name" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Description</nz-form-label>
        <nz-form-control>
          <textarea 
            nz-input 
            formControlName="description" 
            placeholder="Enter output description"
            [nzAutosize]="{ minRows: 3, maxRows: 6 }"></textarea>
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>

<!-- Milestone Detail Modal -->
<nz-modal
  [(nzVisible)]="milestoneDetailModalVisible"
  nzTitle="Milestone Details"
  [nzFooter]="milestoneDetailFooter"
  (nzOnCancel)="closeMilestoneDetail()"
  nzWidth="700px">
  <ng-container *nzModalContent>
    <div class="milestone-detail" *ngIf="selectedMilestone">
      <!-- Basic Info -->
      <div class="detail-section">
        <h4 class="section-title">
          <span nz-icon nzType="info-circle" nzTheme="outline"></span>
          Basic Information
        </h4>
        <nz-descriptions nzBordered [nzColumn]="2" nzSize="small">
          <nz-descriptions-item nzTitle="Name" [nzSpan]="2">
            <span class="milestone-name-text">{{ selectedMilestone.name }}</span>
            <nz-tag *ngIf="selectedMilestone.isCritical" nzColor="red" style="margin-left: 8px;">
              <span nz-icon nzType="exclamation-circle" nzTheme="outline"></span>
              Critical
            </nz-tag>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Description" [nzSpan]="2">
            {{ selectedMilestone.description || 'No description' }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Workstream">
            {{ selectedMilestone.workstreamName }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Output">
            {{ selectedMilestone.outputName }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="PIC">
            <span nz-icon nzType="user" nzTheme="outline"></span>
            {{ selectedMilestone.picUserName }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Status">
            <nz-tag [nzColor]="getMilestoneStatusColor(selectedMilestone.status)">
              {{ getMilestoneStatusLabel(selectedMilestone.status) }}
            </nz-tag>
          </nz-descriptions-item>
        </nz-descriptions>
      </div>

      <!-- Timeline -->
      <div class="detail-section">
        <h4 class="section-title">
          <span nz-icon nzType="calendar" nzTheme="outline"></span>
          Timeline
        </h4>
        <nz-descriptions nzBordered [nzColumn]="2" nzSize="small">
          <nz-descriptions-item nzTitle="Planned Start">
            {{ selectedMilestone.plannedStartDate ? (selectedMilestone.plannedStartDate | date:'dd MMM yyyy') : 'Not set' }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Planned End">
            {{ selectedMilestone.plannedEndDate ? (selectedMilestone.plannedEndDate | date:'dd MMM yyyy') : 'Not set' }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Actual Start">
            {{ selectedMilestone.actualStartDate ? (selectedMilestone.actualStartDate | date:'dd MMM yyyy') : 'Not started' }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Actual End">
            {{ selectedMilestone.actualEndDate ? (selectedMilestone.actualEndDate | date:'dd MMM yyyy') : 'Not completed' }}
          </nz-descriptions-item>
        </nz-descriptions>
      </div>

      <!-- Progress -->
      <div class="detail-section">
        <h4 class="section-title">
          <span nz-icon nzType="line-chart" nzTheme="outline"></span>
          Progress
        </h4>
        <div class="progress-container">
          <nz-progress 
            [nzPercent]="selectedMilestone.progress" 
            [nzStatus]="selectedMilestone.progress === 100 ? 'success' : 'active'"
            [nzStrokeWidth]="12">
          </nz-progress>
        </div>
      </div>

      <!-- Approval Status -->
      <div class="detail-section">
        <h4 class="section-title">
          <span nz-icon nzType="check-circle" nzTheme="outline"></span>
          Approval Status
        </h4>
        <nz-descriptions nzBordered [nzColumn]="1" nzSize="small">
          <nz-descriptions-item nzTitle="Status">
            <nz-tag [nzColor]="getApprovalStatusColor(selectedMilestone.approvalStatus)">
              {{ getApprovalStatusLabel(selectedMilestone.approvalStatus) }}
            </nz-tag>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Approved At" *ngIf="selectedMilestone.approvedAt">
            {{ selectedMilestone.approvedAt | date:'dd MMM yyyy HH:mm' }}
          </nz-descriptions-item>
        </nz-descriptions>
      </div>
    </div>
  </ng-container>

  <ng-template #milestoneDetailFooter>
    <div class="modal-footer-actions">
      <button nz-button nzType="default" (click)="closeMilestoneDetail()">
        Close
      </button>
      <div *ngIf="selectedMilestone?.approvalStatus === 'pending'" class="approval-buttons">
        <button 
          nz-button 
          nzType="default" 
          nzDanger 
          nz-popconfirm
          nzPopconfirmTitle="Are you sure you want to reject this milestone?"
          (nzOnConfirm)="rejectMilestone(selectedMilestone!.id)">
          <span nz-icon nzType="close-circle" nzTheme="outline"></span>
          Reject
        </button>
        <button 
          nz-button 
          nzType="primary"
          nz-popconfirm
          nzPopconfirmTitle="Are you sure you want to approve this milestone?"
          (nzOnConfirm)="approveMilestone(selectedMilestone!.id)">
          <span nz-icon nzType="check-circle" nzTheme="outline"></span>
          Approve
        </button>
      </div>
    </div>
  </ng-template>
</nz-modal>